var Board = require("../lib/firmata").Board;
var SerialPort = require("serialport");
var rport = /usb|acm|^com/i;

SerialPort.list(function(err, ports) {
  ports.forEach(function(port) {
    if (rport.test(port.comName)) {
      console.log("ATTEMPTING: ", port.comName);

      var board = new Board(port.comName);

      board.on("ready", function() {
        console.log("Ready");

        var settings = {
          pin: 3,
          value: 1,
          pulseOut: 5
        };

        var continuousRead = function() {
          this.pingRead(settings, function(duration) {
            console.log(duration);

            setTimeout(continuousRead, 50);
          });
        }.bind(this);

        continuousRead();
      });
    }
  });
});


